/*
 * Butter Application butter.application.js
 * Version 0.1.0
 *
 * Developed by Bocoup on behalf of the Mozilla Foundation
 * Copyright (c) 2011 Bocoup, LLC
 * Authors: Rick Waldron, Alistair McDonald, Boaz Sender
 * Dual licensed under the MIT and GPL licenses.
 * http://code.bocoup.com/license/
 *
 */
(function(w,B){var c=w.parseFloat,g=w.parseInt;B.mixin({capitalize:function(h){return h.charAt(0).toUpperCase()+h.substring(1).toLowerCase()},camel:function(h){return h.replace(/(\-[a-z])/g,function(m){return m.toUpperCase().replace("-","")})},slug:function(h){return h.toLowerCase().match(/[a-z0-9]+/ig).join("-")},pad:function(h){return(h<10?"0":"")+h},fract:function(h,m){return Math.round(h*m)/m},fourth:function(h){return B(h).fract(4)},smpteToSeconds:function(h){h=h.split(":");if(h.length===1)return c(h[0],
10);if(h.length===2)return c(h[0],10)+c(h[1]/12,10);if(h.length===3)return g(h[0]*60,10)+c(h[1],10)+c(h[2]/12,10);if(h.length===4)return g(h[0]*3600,10)+g(h[1]*60,10)+c(h[2],10)+c(h[3]/12,10)}})})(window,_);
(function(w,B,c,g){function h(m,p,v,e,i){this.title=m||null;this.description=p||null;this.remote=v||null;this.theme=e||null;this.layout=i||null;this.data=null;return this}h.properties=["title","description","remote","theme","layout"];g.each(h.properties,function(m){h.prototype[g(m).capitalize()]=function(p){return!p&&this[m]||(this[m]=p)}});h.prototype.prepare=function(m){var p={},v=g.size(m),e=0;g.each(h.properties,function(i){p[i]=this[g(i).capitalize()]()},this);p.data=[];g.each(m,function(i){if(e>
0&&e<v-1){var L={},x={},R=i._natives.type;g.each(i,function(C,E){if(E.indexOf("_")!==0&&C)x[E]=C});L[R]=x;p.data.push(L)}e++});return p};h.prototype.serialize=function(m){return JSON.stringify(this.prepare(m))};h.prototype.slug=function(){return(this.title||"").toLowerCase().match(/[a-z0-9]+/ig).join("-")};h.prototype.parse=function(m){return JSON.parse(this.read(m))};h.prototype.create=function(m,p){if(!g.isString(m)){p=m;m=this.slug()}var v=this.serialize(p);localStorage.setItem(m,v);return{slug:m,
serial:v}};h.prototype.read=function(m){return localStorage.getItem(m)||null};h.prototype.update=function(m,p){return this.create(m,p)};h.prototype.remove=function(m){return localStorage.removeItem(m)};h.getStorageAsObject=function(){for(var m=-1,p=localStorage.length,v={},e;++m<p;){e=localStorage.key(m);v[e]=(new Function("return "+localStorage.getItem(e)))()}return v};w.TrackStore=h})(window,document,$,_,Popcorn);
(function(w,B,c,g,h){var m={currentTime:function(e){var i=(""+Math.round(e*100)/100).split(".")[1]||"";if(i.length===1)i+="0";i||(i="00");return g(Math.floor(e/3600)).pad()+":"+g(Math.floor(e/60)).pad()+":"+g(Math.floor(e%60)).pad()+":"+(i==="0"?"00":i)},mp4:'video/mp4; codecs="avc1, mp4a"',ogv:'video/ogg; codecs="theora, vorbis"',accepts:[".ogv",".mp4",".webm"]},p=w.setInterval,v=w.clearInterval;c(function(){var e,i=c(B),L=c(w),x=c("body");c("video");c("source");var R=c("#ui-plugin-select-list"),
C=c("#ui-track-event-editor"),E=c("#ui-track-editting"),S=c("#ui-tracks"),aa=c("#ui-tracks-time"),M=c("#ui-scrubber-handle"),T=c("#ui-scrubber,#ui-scrubber-handle"),ba=c(".ui-menu-controls"),ca=c("#ui-video-controls"),F=c("#ui-theme"),G=c("#ui-layout"),da=c("#ui-export-to"),Y=c("#io-current-time"),N=c("#io-video-url"),I=c("#io-video-title"),P=c("#io-video-description"),ea=c("#io-video-data"),U=c(".ui-load-ready"),fa=c("#ui-loading-html"),ga=c("#ui-start-screen"),V=c("#ui-application-error"),o=null,
W=null,H={},y,J,A,Z;c("button,.ui-menu-controls").button();c(".ui-accordion-panel").accordion().css("marginTop","-1px");c(".ui-menuset").each(function(){c(this).next("ul").menu({select:function(){c(this).hide()},input:c(this)}).css({position:"absolute",zIndex:999}).hide()}).bind("click",function(){var a=c(this).next("ul");c(".ui-menuset ~ ul").hide();if(a.is(":visible")){a.hide();return false}a.menu("deactivate").show().css({top:0,left:0}).position({my:"left top",at:"left bottom",of:this});i.one("click",
function(){a.hide()});return false});x.dims={width:x.width(),height:x.height()};L.bind("load resize",function(){x.dims={width:x.width(),height:x.height()};fa.css({left:x.dims.width/2-64,top:x.dims.height/2-120,width:130});c(".ui-menuset ~ ul").hide().css({top:0,left:0});T.css({height:E.height()})});U.hide();J=function(){return{project:{unload:function(){},load:function(a,b){N.val(b.remote);G.children().removeClass("active").each(function(d,f){var j=c(f);if(j.text().replace(/\s/g,"").toLowerCase()===
b.layout){j.addClass("active");G.attr("data-layout",b.layout)}});F.children().removeClass("active").each(function(d,f){var j=c(f);if(j.text().replace(/\s/g,"").toLowerCase()===b.theme){j.addClass("active");F.attr("data-theme",b.theme)}});y.loadVideoFromUrl(function(){g.each(a,function(d){g.each(d,function(f,j){var k=g.extend({},{id:j},f);A.addTrackEvent.call(k,k)})});I.val(b.title);P.val(b.description)})}},menu:{unload:function(a){a=c(a+" li");a.length&&a.remove()},load:function(a){this.unload(a);
var b=TrackStore.getStorageAsObject(),d;if(g.size(b)>0)g.each(TrackStore.getStorageAsObject(),function(f,j){d=c("<li/>",{html:'<h4><img class="icon" src="img/dummy.png">'+f.title+"</h4>",className:"select-li clickable","data-slug":j}).appendTo(a);d.data("track",f.data);d.data("project",f)});else d=c("<li/>",{html:'<h4><em class="quiet">You have no saved movies</em></h4>'}).appendTo(a)}}}}();w.TrackMeta=J;J.menu.load("#ui-user-videos");J.menu.load("#ui-start-screen-list");ga.dialog({modal:true,autoOpen:true,
width:400,height:400,buttons:{Start:function(){var a=c(this),b=a.children("input").val();a.dialog("close");N.val(b);c('[data-control="load"]').trigger("click")}}});y=function(a){return{timeLineWidth:0,increment:0,isScrubbing:false,inProgress:false,videoReady:function(b,d){var f=p(function(){if(b.video.readyState>=3&&!isNaN(b.video.duration)){d&&d();i.trigger("videoReady");i.trigger("videoLoadComplete");v(f)}},13)},timeLineReady:function(b,d){var f=g.bind(function(){this.drawTimeLine(b.video.duration);
d&&d();i.trigger("timelineReady")},this);this.videoReady(b,f)},loadVideoFromUrl:function(b){i.trigger("videoLoadStart");var d=N.val(),f=d.split(".");f=f[f.length-1];var j=this,k,l;c("video").length&&c("video").remove();c("<video/>",{id:"video"}).prependTo("#ui-panel-video");c("<source/>",{type:m[f],src:d}).prependTo("#video");e=h("#video");k=p(function(){if(e.video.currentSrc===d){j.timeLineReady(e,l);v(k)}},13);l=function(){a.$popcorn=e;var n=c("#ui-tracks-time-canvas"),r=c(".track"),t=c(".ui-plugin-pane"),
q=Math.round(n.width()/e.video.duration);I.val("");P.val("");if(g.size(H))H={};r.length&&r.remove();t.children().length&&t.children().remove();M.draggable("destroy");M.draggable({scroll:true,scrollSensitivity:50,scrollSpeed:200,axis:"x",containment:"#ui-track-editting",grid:[q/8,0],start:function(){y.isScrubbing=true},stop:function(){y.isScrubbing=false},drag:function(s,D){var u=D.offset.left-n.position().left;u=e.video.duration/n.width()*u;u=g(u).fourth();e.video.currentTime=u}});e.listen("timeupdate",
function(){Y.val(function(){c(this);var u=g(this.id.replace("io-","")).camel(),K=e[u]();return m[u](g(K).fourth())});var s=g(e.video.currentTime).fourth(),D=p(function(){if(e.video.readyState>=3){j.setScrubberPosition(q*s+n.position().left,{increments:q,current:s});M.position().left>=S.position().left+S.width()&&S.scrollLeft(n.width());y.inProgress=false;v(D)}},13);i.trigger("seekComplete",{type:"update",time:s,increment:q,special:function(){}})});e.trigger("timeupdate");b&&b()}},isScrubberWithin:function(b){var d=
(M.position().left-E.position().left-1)/(y.increment*4);return d>=b.start&&d<=b.end},setScrubberPosition:function(b){var d=1,f;if(arguments.length===2){f=arguments[1];f=Math.round(f.current/3);if(f>0)d+=f+f%2}this.isScrubbing||M.css({left:b-d})},deleteCanvas:function(b,d){var f=B.getElementById(d);f&&B.getElementById(b).removeChild(f)},drawCanvas:function(b,d,f,j){var k=B.createElement("canvas");k.id=d;k.width=f;k.height=j;B.getElementById(b).appendChild(k);return k},drawTimeLine:function(b){y.timeLineWidth=
Math.ceil(Math.ceil(b)/30)*800;this.deleteCanvas("ui-tracks-time","ui-tracks-time-canvas");this.drawCanvas("ui-tracks-time","ui-tracks-time-canvas",y.timeLineWidth,25);var d=B.getElementById("ui-tracks-time-canvas").getContext("2d"),f=y.timeLineWidth/b;b=Math.ceil(b);var j=f/4,k=2,l=0,n=0,r=0,t;y.increment=j;d.font="10px courier";d.fillStyle="#000";for(d.lineWidth=1;l<b*2;l++){if(l>=10)k=6;d.lineWidth=1;d.beginPath();if(l%2||l===0){r++;r<=b&&d.fillText(r,r*f-k,9);t=l*f/2;for(n=0;n<4;n++){d.moveTo(t+
n*j,20);d.lineTo(t+n*j,25)}}else{d.moveTo(l*f/2,10);d.lineTo(l*f/2,25)}d.stroke()}}}}(w);A=function(){return{getTrackEventById:function(a){if(!e.data)return{};var b=h.getTrackEvents(e),d;g.each(b,function(f){if(f._id===a)d=f});return d},destroyTrackEvent:function(a,b,d,f){a.track("killTrackEvent",{_id:d});b.removeTrackEvent(d);b.data.history.indexOf(d)===-1&&i.trigger("removeTrackComplete",{type:f})},addTrackEvent:function(a){if(!e||!e.data)i.trigger("applicationError",{type:"No Video Loaded",message:"I cannot add a Track Event - there is no movie loaded."});
else{var b,d,f,j={},k=this.id,l=h.manifest[k],n={start:2,end:10};arguments.length&&(j=arguments[0]);if(j.currentTarget)j={};g.extend(n,j,{target:h.manifest[k].options.target});g.forEach(l.options,function(r,t){t in n||(n[t]="")});n.id=false;e[k](n);d=e.getLastTrackEventId();e.getTrackEvents();f=A.getTrackEventById(d);if(H[k])b=H[k];else{b=c("<div/>",{title:k,className:"span-21 last track track"+g.size(H)}).insertAfter("#ui-tracks-time");b.width(y.timeLineWidth);b.track({target:c("#video"),duration:e.video.duration});
b.prepend('<span class="large track-label large" >'+g(k).capitalize()+"</span>");H[k]=b}b.track("addTrackEvent",{inPoint:n.start,outPoint:n.end,type:k,popcornEvent:f,popcorn:e,_id:d,editEvent:function(r){if(r.shiftKey)i.trigger("applicationNotice",{message:'Are you sure you want to remove this Track Event? <br><br> <hr class="space">This action is permanent and cannot be undone.',callback:function(){A.destroyTrackEvent(b,e,d,k)}});else{C.dialog({autoOpen:false,title:"Edit "+g(k).capitalize(),buttons:{Cancel:A.editEventCancel,
OK:function(){A.editEventApply.call(f,b,e,d,k);c(this).dialog("close")}}});A.drawTrackEvents.call(this)}}});a?i.trigger(a+"Complete"):i.trigger("addTrackComplete")}},drawTrackEvents:function(){try{C.dialog("close")}catch(a){console&&console.log&&console.log(a)}o=this;var b=o.popcornEvent._natives.manifest.options,d,f;c("#ui-track-event-editor").children("*").remove();if(!o.manifestElems)o.manifestElems={};if(!o.previousValues)o.previousValues={};for(f in b)if(typeof b[f]==="object"){var j=b[f],k=
j.elem;d=j.label;var l;l=c("<"+k+"/>",{className:"text"});o.manifestElems[f]=l;if(g.isNull(W)||W!==o)o.previousValues[f]=o.popcornEvent[f];d=c("<label/>").attr("for",d).text(d);k==="input"&&l.val(o.popcornEvent[f]);k==="select"&&g.each(j.options,function(n){c("<option/>",{value:n,text:g(n).capitalize()}).appendTo(l)});l.appendTo(d);d.appendTo("#ui-track-event-editor")}W=this;C.dialog("open")},editEventApply:function(a,b,d,f){b=o.popcornEvent;var j=b._natives.manifest,k={},l,n;for(l in j.options)if(typeof j.options[l]===
"object"){n=o.manifestElems[l].val();if((b[l]=n)&&["start","end"].indexOf(l)===-1&&!isNaN(n))b[l]=+n}o.inPoint=b.start;o.outPoint=b.end;l=o.popcornEvent;g.each(l,function(r,t){if(t.indexOf("_")!==0&&r)k[t]=r});g.extend(k,{id:f});a.track("killTrackEvent",{_id:d});e.removeTrackEvent(d);c(l._container).remove();A.addTrackEvent.call(k,k);if(y.isScrubberWithin(l)){a=e.getLastTrackEventId();a=A.getTrackEventById(a);a._natives.start(null,a)}i.trigger("videoEditComplete")},editEventCancel:function(){var a=
o.popcornEvent,b;for(b in o.previousValues)if(b)a[b]=o.previousValues[b];o.inPoint=a.start;o.outPoint=a.end;o.parent._draw();C.dialog("close")},editEventOK:function(){A.editEventApply();C.dialog("close")}}}(w);C.tabs();C.css({display:"none"});g.each(h.registry,function(a){c("<li/>",{id:a.type,className:"span-4 select-li clickable",html:"<h3><img class='icon' src='img/"+a.type.split(/\s/)[0].toLowerCase()+".png'> "+g(a.type).capitalize()+"</h3>"}).appendTo("#ui-plugin-select-list")});c.getJSON("layouts/layouts.json",
function(a){g.each(a.layouts,function(b){var d=b.replace(/\s/g,"").toLowerCase();c("<li/>",{html:'<h4><img class="icon" src="img/dummy.png">'+b+"</h4>",className:"select-li clickable"+(G.attr("data-layout")===d?" active":"")}).appendTo(G).data("type",d)})});c.getJSON("themes/themes.json",function(a){g.each(a.themes,function(b){var d=b.replace(/\s/g,"").toLowerCase();c("<li/>",{html:'<h4><img class="icon" src="img/dummy.png">'+b+"</h4>",className:"select-li clickable"+(F.attr("data-theme")===d?" active":
"")}).appendTo(F).data("type",d)})});g.each(["Full Page","Embeddable Fragment","Preview"],function(a){var b=a.split(/\s/)[0].toLowerCase();c("<li/>",{html:'<h4><img class="icon" src="img/'+b+'.png">'+a+"</h4>",className:"select-li clickable"}).appendTo("#ui-export-to").data("type",b)});G.delegate("li","click",function(){var a=c(this);a.toggleClass("active").parents(".is-menu").attr("data-layout",c(this).data("type"));a.siblings().removeClass("active")});F.delegate("li","click",function(){var a=c(this);
a.toggleClass("active").parents(".is-menu").attr("data-theme",c(this).data("type"));a.siblings().removeClass("active")});da.delegate("li","click",function(){if(!e||!e.data)i.trigger("applicationError",{type:"No Video Loaded",message:"I cannot export your movie - there is no video loaded."});else{var a=c(this).data("type"),b=F.attr("data-theme"),d=G.attr("data-layout"),f=c('[data-export="true"]').filter("div"),j={open:"<!doctype html>\n<html>",head:"\n<head>\n",meta:"<title>"+I.val()+"</title>\n",
theme:'<link rel="stylesheet" href="'+location.href+"themes/"+b+'/theme.css" type="text/css" media="screen">\n',layout:'<link rel="stylesheet" href="'+location.href+"layouts/"+d+'/layout.css" type="text/css" media="screen">\n',scripts:"",body:"\n</head>\n<body>\n",html:"",close:"\n</body>\n</html>\n"},k="";b=["$(function () { ",'  var $p = Popcorn("#video")',"  //uncomment to auto play","  //$p.play();","});\n"];var l="",n=["style","width","height"];g.each(["js/jquery.js","popcorn-js/popcorn.js",
"popcorn-js/plugins/googleMap/popcorn.googleMap.js","popcorn-js/plugins/footnote/popcorn.footnote.js","popcorn-js/plugins/webpage/popcorn.webpage.js","popcorn-js/plugins/flickr/popcorn.flickr.js","popcorn-js/plugins/image/popcorn.image.js","popcorn-js/plugins/wikipedia/popcorn.wikipedia.js"],function(q){if(/plugins/.test(q))q=q.replace("plugins","plugins-playback");j.scripts+='<script src="'+location.href+q+'"><\/script>\n'});d=(new TrackStore).serialize(e.data.trackEvents.byStart);d=JSON.parse(d);
var r=[],t=[];g.each(d.data,function(q){g.each(q,function(s,D){var u=g.extend({},{id:D},s),K={};g.each(u,function(O,ha){K[ha]=!isNaN(+O)?+O:O});r.push(D+"("+JSON.stringify(K)+")");t.push(D)})});if(r.length){f.each(function(){var q=c(this),s=q.clone();q.width();q.height();s.children("#ui-video-controls,hr").remove();if(s.children("video").length){q=c("<div/>",{className:"butter-video-player"});var D=s.children("video").clone();D.attr("controls","controls");q.append('\n        <h1 id="videoTitle">'+
I.val()+"</h1>\n        ").append(D).append('\n        <p id="videoDescription">'+P.val()+"</p>\n      ");s.children("video").replaceWith(q);k+='\n    <div class="butter-video">\n      '+c.trim(s.html())+"\n    </div>\n  "}if(s.children(".ui-plugin-pane").length){s.children(".ui-plugin-pane").each(function(){var u=c(this);if(g.contains(t,u.data("plugin"))){u.attr("class","butter-plugin").children().remove();g.each(n,function(O){u.removeAttr(O)})}else{var K=u.data("plugin");s.children('[data-plugin="'+
K+'"]').remove()}});k+='\n    <div class="butter-plugins">\n       '+s.html()+"\n    </div>\n"}});b[1]+="."+r.join(".")+";";j.scripts+="\n<script>"+b.join("\n")+"<\/script>";j.html=' <div class="butter-player">'+k+"  </div>";if(a==="full")g.each(j,function(q){l+=q});else l=j.scripts+"\n"+j.theme+"\n"+j.layout+"\n"+j.html;i.trigger("exportReady",{type:a,content:l})}else i.trigger("applicationError",{type:"Stage Empty",message:"I cannot export your movie - the stage is totes empty!"})}});i.bind("applicationError applicationNotice applicationAlert",
function(a,b){var d=function(){c(this).dialog("close");c("#ui-error-rendered").remove();V.empty()},f={Close:d};if(a.type==="applicationNotice"){f={Cancel:d,Ok:function(){b.callback&&b.callback();d.call(this)}};if(!b.type)b.type="Confirm"}V.empty();c("<div/>",{id:"ui-error-rendered",html:b.message}).appendTo("#ui-application-error");V.dialog({title:b.type,height:b.message?200:0,buttons:f,width:300,modal:true,autoOpen:true})});Z=function(){return{typemap:{preview:"iframe",embeddable:"textarea",full:"textarea"},
exports:function(a){this.render[this.typemap[a.type]](a.parent,a.content)},render:{iframe:function(a,b){var d=c("<iframe/>",{id:"ui-preview-rendered"}).width("100%").height(a.height()-100);a.html(d);d=c("#ui-preview-rendered")[0];d=d.contentWindow?d.contentWindow:d.contentDocument.document?d.contentDocument.document:d.contentDocument;d.document.open();d.document.write(b);d.document.close()},textarea:function(a,b){var d=c("<textarea/>",{id:"ui-preview-rendered"}).width(a.width()-100).height(a.height()-
100);d.val(b);a.html(d)}}}}(w);i.bind("exportReady",function(a,b){var d=c("#ui-preview-viewer").dialog({modal:true,width:x.width()-50,height:x.height()-50,autoOpen:true,title:g(b.type).capitalize(),buttons:{Close:function(){c(this).dialog("close");c("#ui-preview-rendered").remove()}}});g.extend(b,{parent:d});Z.exports(b)});R.delegate("li","click",function(a){A.addTrackEvent.call(this,a)});c("#ui-start-screen-list, #ui-user-videos").delegate("li","click",function(){var a=c(this),b=a.data("track"),
d=a.data("project");d&&J.project.load(b,d);a.parents("#ui-start-screen-list").length&&c("#ui-start-screen").dialog("close")});L.bind("resize",function(){e.trigger("timeupdate")});i.bind("addTrackComplete",function(){T.css({height:E.height()})});i.bind("removeTrackComplete",function(a,b){var d=h.getTrackEvents(e),f=b.type,j=0;g.each(d,function(k){k._id.indexOf(f)===0&&j++});if(!j){c('div[title="'+f+'"]').remove();delete H[f]}I.val()&&X.save()});i.bind("timelineReady videoReady",function(){T.css({height:E.height()})});
i.bind("videoLoadStart videoLoadComplete",function(a){a.type==="videoLoadStart"?U.show():U.hide()});i.bind("seekComplete",function(a,b){b.special&&b.special();b.type==="last"&&c("#ui-tracks").scrollLeft(c("#ui-tracks-time-canvas").width());b.type==="first"&&c("#ui-tracks").scrollLeft(0)});i.bind("videoEditComplete addTrackComplete",function(){var a=new TrackStore;ea.val(a.serialize(e.data.trackEvents.byStart))});var z=0,Q=0,X={load:function(){Q=z=0;var a=N.val(),b=/(.ogv)|(.mp4)|(.webm)/gi;!a||!b.test(a)?
i.trigger("applicationError",{type:!b.test(a)?"Invalid Movie Url":"No Video Loaded",message:"Please provide a valid movie url. ("+m.accepts.join(", ")+") "}):y.loadVideoFromUrl()},remove:function(){},save:function(){if(!e||!e.data)i.trigger("applicationError",{type:"No Video Loaded",message:"I cannot add a Track Event - there is no movie loaded."});else{var a=new TrackStore,b=I.val(),d=P.val(),f=N.val(),j=F.attr("data-theme"),k=G.attr("data-layout"),l;if(b){l=g(b).slug();a.Title(b);a.Description(d);
a.Remote(f);a.Theme(j);a.Layout(k);a.read(l)?a.update(l,e.data.trackEvents.byStart):a.create(e.data.trackEvents.byStart);J.menu.load("#ui-user-videos");c("#ui-user-videos li[data-slug='"+l+"']").trigger("click")}else i.trigger("applicationError",{type:"No Title",message:"You will need to add a title in order to save your project."})}},play:function(){e.video.play()},pause:function(){e.video.pause()},volume:function(a){if(a==="up")Q=e.video.volume+0.1;if(a==="down")Q=e.video.volume-0.1;e.video.volume=
Q},seek:function(a){if(a.indexOf(":")>-1){var b=c("#"+(a.split(":")[1]||""));z=g(b.val()).smpteToSeconds()}if(a==="first"){z=0;i.trigger("seeked","first")}if(a==="prev"){z=g(e.video.currentTime-0.25).fourth();i.trigger("seeked","prev")}if(a==="next"){z=g(e.video.currentTime+0.25).fourth();i.trigger("seeked","next")}if(a==="last"){z=e.video.duration;i.trigger("seeked","last")}if(z>e.video.duration)z=e.video.duration;if(z<0)z=0;e.video.currentTime=z;var d=p(function(){if(e.video.readyState>=3){i.trigger("seekComplete",
{type:a,time:z});v(d)}},1)}};aa.bind("click",function(a){if(e.video){c(this);var b=Math.round(c("#ui-tracks-time-canvas").width()/e.video.duration);a=g(a.offsetX/b).fourth();e.video.currentTime=a}});ba.bind("click",function(a){a.preventDefault();a=c(this);a.attr("data-control")&&X[a.attr("data-control")]()});ca.children("button").bind("click",function(){var a=c(this).children("span").children("span");!e||!e.data?i.trigger("applicationError",{type:"No Video Loaded",message:"I cannot "+a.attr("data-control")+
" - there is no video loaded"}):X[a.attr("data-control")](a.attr("data-opt"))});Y.bind("keydown",function(a){a.which===13&&c("#io-current-time").next().trigger("click");a.which===39&&c('[data-opt="next"]').parents("button").trigger("click");a.which===37&&c('[data-opt="prev"]').parents("button").trigger("click")});w.$popcorn=e})})(this,this.document,this.jQuery,this._,this.Popcorn);